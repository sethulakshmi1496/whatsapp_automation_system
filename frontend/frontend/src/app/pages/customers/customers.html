<!-- frontend/src/app/pages/customers/customers.html -->
<div class="dashboard-layout">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <app-header></app-header>

    <div class="content-area">
      <div class="page-header">
        <div>
          <h2>Customers</h2>
          <p>Manage your customer database</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-primary" (click)="openAddModal()">
            <span>‚ûï</span> Add Customer
          </button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="search-bar">
        <input type="text" [(ngModel)]="searchQuery" (input)="filterCustomers()"
          placeholder="üîç Search by name, phone, or email...">
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading customers...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-state">
        <span class="error-icon">‚ö†Ô∏è</span>
        <p>{{ error }}</p>
        <button class="btn btn-secondary" (click)="loadCustomers()">Retry</button>
      </div>

      <!-- Customers Table -->
      <div *ngIf="!loading && !error" class="table-container">
        <table class="data-table" *ngIf="filteredCustomers.length > 0">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Tags</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let customer of filteredCustomers; let i = index"
              [class.highlight]="customer.id === selectedCustomer?.id">
              <td>{{ i + 1 }}</td>
              <td>
                <div class="customer-name">
                  <span class="avatar">{{ getInitials(customer.name) }}</span>
                  <strong>{{ customer.name }}</strong>
                </div>
              </td>
              <td>{{ customer.phone }}</td>
              <td>{{ customer.email || '‚Äî' }}</td>
              <td>
                <span *ngIf="customer.tags && customer.tags.length > 0" class="tags">
                  <span class="tag" *ngFor="let tag of customer.tags">{{ tag }}</span>
                </span>
                <span *ngIf="!customer.tags || customer.tags.length === 0" class="no-tags">‚Äî</span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="action-btn send" (click)="selectCustomerForMessage(customer)" title="Send Message">
                    üí¨
                  </button>
                  <button class="action-btn edit" (click)="openEditModal(customer)" title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button class="action-btn delete" (click)="confirmDelete(customer)" title="Delete">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div *ngIf="filteredCustomers.length === 0 && customers.length > 0" class="no-data">
          <span class="empty-icon">üîç</span>
          <h3>No customers found</h3>
          <p>Try adjusting your search query</p>
        </div>

        <div *ngIf="customers.length === 0" class="no-data">
          <span class="empty-icon">üë•</span>
          <h3>No customers yet</h3>
          <p>Add your first customer to get started</p>
          <button class="btn btn-primary" (click)="openAddModal()">Add Customer</button>
        </div>
      </div>

      <!-- Customer Stats -->
      <div *ngIf="!loading && customers.length > 0" class="stats-bar">
        <div class="stat">
          <span class="stat-label">Total Customers</span>
          <span class="stat-value">{{ customers.length }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Showing</span>
          <span class="stat-value">{{ filteredCustomers.length }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="modal" (click)="closeDeleteModal()">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>‚ö†Ô∏è Confirm Delete</h3>
      <button class="close-btn" (click)="closeDeleteModal()">√ó</button>
    </div>
    <div class="modal-body">
      <p class="warning-text">Are you sure you want to delete this customer?</p>
      <div class="customer-info">
        <p><strong>Name:</strong> {{ customerToDelete?.name }}</p>
        <p><strong>Phone:</strong> {{ customerToDelete?.phone }}</p>
      </div>
      <p class="info-text">This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button class="btn btn-danger" (click)="deleteCustomer()" [disabled]="deleting">
        {{ deleting ? 'Deleting...' : 'Delete Customer' }}
      </button>
    </div>
  </div>
</div>

<!-- Add/Edit Customer Modal -->
<div *ngIf="showCustomerModal" class="modal" (click)="closeCustomerModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isEditMode ? '‚úèÔ∏è Edit Customer' : '‚ûï Add Customer' }}</h3>
      <button class="close-btn" (click)="closeCustomerModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Name *</label>
        <input type="text" [(ngModel)]="customerForm.name" placeholder="Enter customer name">
      </div>
      <div class="form-group">
        <label>Phone *</label>
        <input type="text" [(ngModel)]="customerForm.phone" placeholder="Enter phone number">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" [(ngModel)]="customerForm.email" placeholder="Enter email address">
      </div>
      <div class="form-group">
        <label>Tags (comma-separated)</label>
        <input type="text" [(ngModel)]="customerForm.tagsInput" placeholder="e.g., VIP, Premium, New">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCustomerModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveCustomer()" [disabled]="saving">
        {{ saving ? 'Saving...' : (isEditMode ? 'Update' : 'Add Customer') }}
      </button>
    </div>
  </div>
</div>

<!-- Send Message Modal -->
<div *ngIf="showMessageModal" class="modal" (click)="closeMessageModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üí¨ Send Message</h3>
      <button class="close-btn" (click)="closeMessageModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="customer-info">
        <p><strong>To:</strong> {{ selectedCustomer?.name }} ({{ selectedCustomer?.phone }})</p>
      </div>
      <div class="form-group">
        <label>Message</label>
        <textarea [(ngModel)]="messageText" rows="6" placeholder="Type your message here..."
          class="message-textarea"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeMessageModal()">Cancel</button>
      <button class="btn btn-primary" (click)="sendMessage()" [disabled]="sending || !messageText.trim()">
        {{ sending ? 'Sending...' : 'Send Message' }}
      </button>
    </div>
  </div>
</div>